<svg viewBox="0 0 1550 850" xmlns="http://www.w3.org/2000/svg" style="background-color: #1e1e1e; font-family: 'Segoe UI', sans-serif;">

  <!-- Definitions -->
  <defs>
    <marker id="dot" markerWidth="8" markerHeight="8" refX="4" refY="4">
      <circle cx="4" cy="4" r="3" fill="#ffffff" />
    </marker>
    <style>
      /* Component Styling */
      .module-body { fill: #252526; stroke: #555; stroke-width: 2; rx: 12; }
      .module-text { fill: #e0e0e0; font-size: 18px; font-weight: bold; font-family: 'Segoe UI', sans-serif; }
      .sub-text { fill: #888; font-size: 14px; font-style: italic; }
      
      /* Pin Text */
      .pin-text { fill: #aaaaaa; font-size: 13px; font-family: 'Consolas', monospace; font-weight: bold; dominant-baseline: middle; }
      
      /* Wire Styling */
      .wire-5v { stroke: #ff4444; stroke-width: 3; fill: none; stroke-linecap: round; }
      .wire-3v3 { stroke: #ff9800; stroke-width: 3; fill: none; stroke-linecap: round; }
      .wire-gnd { stroke: #666666; stroke-width: 3; fill: none; stroke-linecap: round; }
      .wire-sig { stroke: #4fc3f7; stroke-width: 2.5; fill: none; stroke-linecap: round; }
      
      /* Interaction */
      g:hover .module-body { stroke: #fff; cursor: pointer; }
    </style>
  </defs>

  <!-- ================= 1. POWER SUBSYSTEM (LEFT) ================= -->

  <!-- Solar Panel -->
  <g transform="translate(50, 100)">
    <rect width="160" height="100" class="module-body" />
    <text x="70" y="40" text-anchor="middle" class="module-text">Solar Panel</text>
    <text x="70" y="65" text-anchor="middle" class="sub-text">6V / 5W</text>
    
    <circle cx="160" cy="30" r="5" fill="#ff4444"/> <text x="140" y="30" class="pin-text" text-anchor="end">+</text>
    <circle cx="160" cy="70" r="5" fill="#666"/> <text x="140" y="70" class="pin-text" text-anchor="end">-</text>
  </g>

  <!-- CN3065 -->
  <g transform="translate(300, 100)">
    <rect width="180" height="140" class="module-body" />
    
    <text x="90" y="85" text-anchor="middle" class="module-text">CN3065</text>
    <text x="90" y="105" text-anchor="middle" class="sub-text">Power Mgmt</text>
    
    <circle cx="0" cy="30" r="5" fill="#ff4444"/> <text x="20" y="30" class="pin-text">IN</text>
    <circle cx="0" cy="70" r="5" fill="#666"/> <text x="20" y="70" class="pin-text">GND</text>
    
    <circle cx="60" cy="140" r="5" fill="#ff4444"/> <text x="50" y="120" class="pin-text" text-anchor="end">BAT+</text>
    <circle cx="120" cy="140" r="5" fill="#666"/> <text x="130" y="120" class="pin-text" text-anchor="start">BAT-</text>
    
    <circle cx="180" cy="30" r="5" fill="#ff4444"/> <text x="160" y="30" class="pin-text" text-anchor="end">OUT</text>
    <circle cx="180" cy="70" r="5" fill="#666"/> <text x="160" y="70" class="pin-text" text-anchor="end">GND</text>
  </g>

  <!-- Battery -->
  <g transform="translate(300, 350)">
    <rect width="180" height="80" class="module-body" stroke="#4caf50"/>
    <text x="90" y="40" text-anchor="middle" class="module-text">Li-Ion Battery</text>
    <text x="90" y="60" text-anchor="middle" class="sub-text">3.7V 10000mAh</text>
    <circle cx="60" cy="0" r="5" fill="#ff4444"/>
    <circle cx="120" cy="0" r="5" fill="#666"/>
  </g>

  <!-- Boost Converter -->
  <g transform="translate(580, 100)">
    <rect width="180" height="120" class="module-body" />
    
    <text x="90" y="95" text-anchor="middle" class="module-text">Boost Conv.</text>
    <text x="90" y="113" text-anchor="middle" class="sub-text">Output: 5V</text>
    
    <circle cx="0" cy="30" r="5" fill="#ff4444"/> <text x="20" y="30" class="pin-text">IN+</text>
    <circle cx="0" cy="70" r="5" fill="#666"/> <text x="20" y="70" class="pin-text">IN-</text>
    
    <circle cx="180" cy="30" r="5" fill="#ff4444"/> <text x="160" y="30" class="pin-text" text-anchor="end">VOUT</text>
    <circle cx="180" cy="70" r="5" fill="#666"/> <text x="160" y="70" class="pin-text" text-anchor="end">GND</text>
  </g>

  <!-- ================= 2. PROCESSING (CENTER) ================= -->

  <!-- ESP32 -->
  <g transform="translate(850, 50)">
    <rect width="220" height="320" class="module-body" fill="#333"/>
    <text x="110" y="40" text-anchor="middle" class="module-text" fill="#fff">ESP32</text>
    <text x="110" y="65" text-anchor="middle" class="sub-text">NodeMCU-32S</text>
    
    <circle cx="0" cy="80" r="5" fill="#ff4444"/> <text x="20" y="80" class="pin-text">VIN (5V)</text>
    <circle cx="0" cy="120" r="5" fill="#666"/> <text x="20" y="120" class="pin-text">GND</text>

    <circle cx="220" cy="80" r="5" fill="#ff9800"/> <text x="200" y="80" class="pin-text" text-anchor="end">3V3 Out</text>
    <circle cx="220" cy="120" r="5" fill="#666"/> <text x="200" y="120" class="pin-text" text-anchor="end">GND</text>
    
    <circle cx="220" cy="180" r="5" fill="#4fc3f7"/> <text x="200" y="180" class="pin-text" text-anchor="end">G21 (SDA)</text>
    <circle cx="220" cy="210" r="5" fill="#4fc3f7"/> <text x="200" y="210" class="pin-text" text-anchor="end">G22 (SCL)</text>
    <circle cx="220" cy="240" r="5" fill="#4fc3f7"/> <text x="200" y="240" class="pin-text" text-anchor="end">G32 (ADC)</text>
    <circle cx="220" cy="270" r="5" fill="#4fc3f7"/> <text x="200" y="270" class="pin-text" text-anchor="end">G5 (OneWire)</text>
  </g>

  <!-- ================= 3. SENSORS (FAR RIGHT) ================= -->

  <!-- SHT40 -->
  <g transform="translate(1300, 60)">
    <rect width="190" height="100" class="module-body" />
    <text x="105" y="35" text-anchor="middle" class="module-text">SHT40</text>
    <text x="105" y="55" text-anchor="middle" class="sub-text">Air Temp/Hum</text>
    
    <circle cx="0" cy="30" r="4" fill="#ff9800"/> <text x="15" y="30" class="pin-text">VCC</text>
    <circle cx="0" cy="50" r="4" fill="#4fc3f7"/> <text x="15" y="50" class="pin-text">SDA</text>
    <circle cx="0" cy="65" r="4" fill="#4fc3f7"/> <text x="15" y="65" class="pin-text">SCL</text>
    <circle cx="0" cy="80" r="4" fill="#666"/> <text x="15" y="80" class="pin-text">GND</text>
  </g>

  <!-- Soil Moisture -->
  <g transform="translate(1300, 220)">
    <rect width="190" height="90" class="module-body" />
    <text x="105" y="35" text-anchor="middle" class="module-text">Capacitive</text>
    <text x="105" y="55" text-anchor="middle" class="sub-text">Soil Moisture</text>
    
    <circle cx="0" cy="30" r="4" fill="#ff9800"/> <text x="15" y="30" class="pin-text">VCC</text>
    <circle cx="0" cy="50" r="4" fill="#4fc3f7"/> <text x="15" y="50" class="pin-text">AOUT</text>
    <circle cx="0" cy="70" r="4" fill="#666"/> <text x="15" y="70" class="pin-text">GND</text>
  </g>

  <!-- DS18B20 -->
  <g transform="translate(1300, 360)">
    <rect width="190" height="90" class="module-body" />
    <text x="105" y="35" text-anchor="middle" class="module-text">DS18B20</text>
    <text x="105" y="55" text-anchor="middle" class="sub-text">Soil Temp</text>
    
    <circle cx="0" cy="30" r="4" fill="#ff9800"/> <text x="15" y="30" class="pin-text">VCC</text>
    <circle cx="0" cy="50" r="4" fill="#4fc3f7"/> <text x="15" y="50" class="pin-text">DATA</text>
    <circle cx="0" cy="70" r="4" fill="#666"/> <text x="15" y="70" class="pin-text">GND</text>
  </g>

  <!-- ================= 4. WIRING & BUSES ================= -->

  <!-- Solar to BQ -->
  <path d="M 210 130 L 300 130" class="wire-5v" marker-mid="url(#dot)"/>
  <path d="M 210 170 L 300 170" class="wire-gnd" />

  <!-- BQ to Battery -->
  <path d="M 360 240 L 360 350" class="wire-5v" />
  <path d="M 420 240 L 420 350" class="wire-gnd" />

  <!-- BQ to Boost -->
  <path d="M 480 130 L 580 130" class="wire-5v" />
  <text x="530" y="120" class="pin-text" fill="#ff4444" text-anchor="middle" font-size="14" font-weight="bold">3.5-4.2V</text>
  <path d="M 480 170 L 580 170" class="wire-gnd" />

  <!-- Boost to ESP32 -->
  <path d="M 760 130 L 850 130" class="wire-5v" /> 
  <text x="790" y="120" fill="#ff4444" font-size="14" font-weight="bold">5V IN</text>
  <path d="M 760 170 L 850 170" class="wire-gnd" />


  <!-- === IMPROVED BUS SYSTEM === -->

  <!-- 3.3V RAIL (Orange) -->
  <path d="M 1160 90 L 1160 390" class="wire-3v3" />
  <path d="M 1070 130 L 1160 130" class="wire-3v3" />
  <text x="1165" y="80" fill="#ff9800" font-size="14" font-weight="bold">3.3V</text>

  <!-- Taps to Sensors -->
  <path d="M 1160 90 L 1302 90" class="wire-3v3" /> 
  <path d="M 1160 250 L 1302 250" class="wire-3v3" />
  <path d="M 1160 390 L 1302 390" class="wire-3v3" />


  <!-- GROUND RAIL (Grey) -->
  <path d="M 1220 140 L 1220 430" class="wire-gnd" />
  <path d="M 1070 170 L 1220 170" class="wire-gnd" />
  <text x="1225" y="445" fill="#666" font-size="14" font-weight="bold">GND</text>

  <!-- Taps to Sensors -->
  <path d="M 1220 140 L 1302 140" class="wire-gnd" />
  <path d="M 1220 290 L 1302 290" class="wire-gnd" />
  <path d="M 1220 430 L 1302 430" class="wire-gnd" />


  <!-- === CLEANED SIGNAL WIRES (Blue) === -->
  <!-- SHT40 I2C -->
  <path d="M 1070 230 L 1100 230 L 1100 110 L 1302 110" class="wire-sig" stroke-dasharray="5,5"/>
  <path d="M 1070 260 L 1115 260 L 1115 125 L 1302 125" class="wire-sig" stroke-dasharray="5,5"/>

  <!-- Moisture Analog -->
  <path d="M 1070 290 L 1130 290 L 1130 270 L 1302 270" class="wire-sig" />

  <!-- DS18B20 Data -->
  <path d="M 1070 320 L 1145 320 L 1145 410 L 1302 410" class="wire-sig" />


  <!-- Legend -->
  <g transform="translate(50, 650)">
    <rect x="-20" y="-20" width="200" height="140" fill="#252526" stroke="#555" rx="10"/>
    <text x="0" y="0" fill="#fff" font-weight="bold" font-size="18">Legend:</text>
    
    <line x1="0" y1="25" x2="40" y2="25" class="wire-5v" /> 
    <text x="50" y="30" fill="#ff4444" font-size="15" dominant-baseline="middle">5V Power</text>
    
    <line x1="0" y1="50" x2="40" y2="50" class="wire-3v3" /> 
    <text x="50" y="55" fill="#ff9800" font-size="15" dominant-baseline="middle">3.3V Power</text>
    
    <line x1="0" y1="75" x2="40" y2="75" class="wire-gnd" /> 
    <text x="50" y="80" fill="#888" font-size="15" dominant-baseline="middle">Ground</text>
    
    <line x1="0" y1="100" x2="40" y2="100" class="wire-sig" /> 
    <text x="50" y="105" fill="#4fc3f7" font-size="15" dominant-baseline="middle">Signal</text>
  </g>

</svg>